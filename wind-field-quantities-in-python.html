<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Python packages to calculate wind field quantities - Meteodenny</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://dennissergeev.github.io/wind-field-quantities-in-python.html">

        <meta name="author" content="dennissergeev" />
        <meta name="keywords" content="python,meteorology" />
        <meta name="description" content="This post is merely sort of my own &#34;lab notes&#34;, and I have to test the packages on a common simple example with known result. So I hope to rewrite it sooner or later. Anyway, below are the links to some of the Python packages that have functions for calculating such wind field quantities as divergence and vorticity (curl, rotor). I am not yet sure what I&#39;m going to use in my research, maybe it&#39;s better to write my own Python function. Or write it in Fortran and wrap it with f2py. Or simply use Iris package (see update below!)." />

        <meta property="og:site_name" content="Meteodenny" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Python packages to calculate wind field quantities"/>
        <meta property="og:url" content="http://dennissergeev.github.io/wind-field-quantities-in-python.html"/>
        <meta property="og:description" content="This post is merely sort of my own &#34;lab notes&#34;, and I have to test the packages on a common simple example with known result. So I hope to rewrite it sooner or later. Anyway, below are the links to some of the Python packages that have functions for calculating such wind field quantities as divergence and vorticity (curl, rotor). I am not yet sure what I&#39;m going to use in my research, maybe it&#39;s better to write my own Python function. Or write it in Fortran and wrap it with f2py. Or simply use Iris package (see update below!)."/>
        <meta property="article:published_time" content="2014-12-16" />
            <meta property="article:section" content="misc" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="meteorology" />
            <meta property="article:author" content="dennissergeev" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://dennissergeev.github.io/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://dennissergeev.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://dennissergeev.github.io/theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="http://dennissergeev.github.io/theme/css/style.css" type="text/css"/>
        <link href="http://dennissergeev.github.io/extra/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://dennissergeev.github.io/" class="navbar-brand">
Meteodenny            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://dennissergeev.github.io/pages/about-me.html">
                             About me
                          </a></li>
                         <li><a href="http://dennissergeev.github.io/pages/about-this-blog.html">
                             About this blog
                          </a></li>
                         <li><a href="http://dennissergeev.github.io/pages/my-toolbox.html">
                             My Toolbox
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://dennissergeev.github.io/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://dennissergeev.github.io/wind-field-quantities-in-python.html"
                       rel="bookmark"
                       title="Permalink to Python packages to calculate wind field quantities">
                        Python packages to calculate wind field quantities
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-12-16T16:26:20+00:00"> Tue 16 December 2014</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://dennissergeev.github.io/tag/python.html">python</a>
        /
	<a href="http://dennissergeev.github.io/tag/meteorology.html">meteorology</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><em>This post is merely sort of my own "lab notes", and I have to test the packages on a common simple example with known result. So I hope to rewrite it sooner or later.</em>
Anyway, below are the links to some of the Python packages that have functions for calculating such wind field quantities as divergence and vorticity (curl, rotor). I am not yet sure what I'm going to use in my research, maybe it's better to write my own Python function. Or write it in Fortran and wrap it with f2py. Or simply use <strong>Iris</strong> package (see update below!). </p>


<h2><a href="http://ajdawson.github.io/windspharm/">Windspharm</a></h2>
<p>At first the most promising package seemed to be windspharm, which is a "Python package for performing computations on global wind fields in spherical geometry". For computations it uses spherical harmonics and depends on a NCAR's SPHEREPACK library, access to which is provided by a wrapper <a href="https://code.google.com/p/pyspharm/">pyspharm</a>. This dependency is for some reason never mentioned on the winspharm's website (two possible reasons: I'm blind or it is too obvious). A very good step-by-step example of using the package can be found <a href="https://ocefpaf.github.io/python4oceanographers/blog/2014/04/28/windspharm/">here</a>.</p>
<h3>Pros:</h3>
<ul>
<li>Well-written and makes the code more readable</li>
<li>Consists of several tools that make it easy to prepare data for the processing</li>
<li>The working object VectorWind has 3 interfaces: "standard" - to work with NumPy arrays, "iris" - to work with Iris cubes, and "cdms" - to work with cdms2 variables. "The only differences are that the windspharm.iris and windspharm.cdms interfaces also use the meta-data stored in input variables to construct outputs with meta-data".</li>
<li>Capable of computation of such quantities as: divergence, vorticity, streamfunction, velocity potential, irrotational, and non-divergent components of the wind, vector gradient of a scalar function, magnitude (wind speed).</li>
</ul>
<h3>Cons:</h3>
<ul>
<li>Can be applied only for global fields (spherical harmonics!)</li>
<li>Computes only a vertical component of vorticity (dv/dx - du/dy)</li>
<li>Does not accept missing values (NaN) nor masked array (solution from the site above - fill the missing values with zeros and then reapply the mask to the result)</li>
<li>Rather strange requirements to the input arrays - the leading dimension has to be latitude, and the latitude dimension has to be north-to-south. This can be a source of mistakes in the code, but the bundled tools make it very easy to arrange the data correctly.</li>
</ul>
<h2><a href="http://www.johnny-lin.com/py_pkgs/atmqty/doc/manual.html">AtmQty library</a></h2>
<p>This package offers a wide set of various meteorology-related functions, so you don't need to invent a wheel every time you write a programme in Python. As the website claims, the package "contains methods to calculate atmospheric quantities that are directly derivative (i.e. not requiring time integration or modeling) from standard state variables".</p>
<p>Among the multitude of functions there is a method that provides a method to calculate the relative vorticity and even the isentropic potential vorticity. Just skimming through the source code, I can say that the vorticity calculation is done by using a <a href="http://www.johnny-lin.com/py_pkgs/gemath/doc/curl_2d.html">curl</a> operator from <a href="http://www.johnny-lin.com/py_pkgs/gemath/doc/index.html">gemath</a> package. The curl operator offers different algorithms of calculation, default being set to the first-order finite-differencing (back-ward and forward differencing used at the endpoints, and centered differencing used everywhere else). For calculations on a sphere it can use SPHEREPACK, if available. However, there can be no missing values in the input data.</p>
<h3>Pros:</h3>
<ul>
<li>Has several calculation algorithms</li>
<li>Allows computations on a limited area domain (default is spherical)</li>
<li>Has an extensive documentation and examples, including an <a href="http://www.johnny-lin.com/py_pkgs/atmqty/doc/test_vort.html">example</a> of calculating relative vorticity and comparing the result with ERA-40 reanalysis</li>
</ul>
<h3>Cons:</h3>
<ul>
<li>Is dependent on gemath package and/or SPHEREPACK library</li>
<li>When using finite differences on a spherical grid, values north of 88N or south of 88S latitude are set to missing automatically (because of singularities in the algorithm near the poles)</li>
<li>Computes only a vertical component of vorticity (dv/dx - du/dy)</li>
<li>Seems to be abandoned since 2004 (instead see PyAOS below)</li>
</ul>
<h2><a href="https://github.com/PyAOS/aoslib">PyAOS library</a></h2>
<p>According to the disclaimer, it is "a Python library of standard atmospheric and oceanic sciences calculation routines. It exists mainly so we're all not writing our own routines to calculate potential temperature, isentropic potential vorticity, etc". It is basically a Python wrapper around a library written in Fortran-77. It is most likely a successor of the AtmQty library. This is probably good for speeding up the calculations, though I'm not a fan of the 77 version of Fortran. The subroutine that calculates vorticity is in g2gkinematics.f file and simply employs a centred differences method.</p>
<h3>Pros:</h3>
<ul>
<li>The library itself is a pretty large collection of AOS-related methods</li>
<li>Presumably fast enough due to code written in Fortran</li>
</ul>
<h3>Cons:</h3>
<ul>
<li>Limited functionality, at least in the vorticity calculations</li>
<li>Computes only a vertical component of vorticity (dv/dx - du/dy)</li>
<li>Requires compilation that makes it difficult to change the source code "on-the-go"</li>
<li>Perhaps not the most dynamically developing project</li>
</ul>
<h2><a href="https://wiki.uib.no/gfi/index.php/Dynlib">Dynlib</a></h2>
<p>The Dynlib library is developed at Geophysical Institute, University of Bergen. The project has a beautiful wiki page (the link in the header). The code is written in Fortran-95, mostly by C. Spensberger.</p>
<p>The subroutine that calculates relative vorticity uses centred differences, but returns zeros at the edges for a non-cyclic grid.</p>
<h3>Pros:</h3>
<ul>
<li>The library itself offers an impressive collection of functions that are used in geophysical fluid dynamics, including geostrophic quantities, wind field deformation, etc.</li>
<li>Presumably fast enough due to code written in Fortran</li>
<li>The source code is well-written and very readable</li>
</ul>
<h3>Cons:</h3>
<ul>
<li>Limited functionality, at least in the vorticity calculations</li>
<li>Computes only a vertical component of vorticity (dv/dx - du/dy)</li>
<li>Requires compilation</li>
</ul>
<h2><a href="http://www.malg.eu/vector_field_params.php">Vector field parameters</a></h2>
<p>Looking for a ready solution to the wind field processing, a while ago I run across this script. Since it is posted in a blog dedicated to GIS programming, "input data must be provided as two Arc/Info ASCII grids, storing the x- and y-components of the vector field". The results are also stored in ASCII grids.</p>
<p>Vorticity (and couple of other field quantities) are computed simply by using NumPy gradient, which by default uses centred differences in the interior points.</p>
<h3>Pros:</h3>
<ul>
<li>Good for GIS-users</li>
<li>Pure Python</li>
</ul>
<h3>Cons:</h3>
<ul>
<li>Computes only a vertical component of vorticity (dv/dx - du/dy)</li>
<li>ASCII grids I/O</li>
</ul>
<h2><a href="https://github.com/GeoscienceAustralia/tcrm/tree/master/Utilities">Geoscience Australia repository</a></h2>
<p>Another trivial example of vorticity calculation (again only z-component) is embedded in TCRM model (A statistical-parametric model for assessing wind hazard from tropical cyclones). The code is in pure Python, though the vorticity function depends on another function that converts lon/lat grid step to distance in meters.</p>
<h3>Pros:</h3>
<ul>
<li>Simple code, can be a starting point to write something more</li>
<li>Pure Python</li>
</ul>
<h3>Cons:</h3>
<ul>
<li>Computes only a vertical component of vorticity (dv/dx – du/dy)</li>
<li>The computation is done by using explicit differentiation in two loops, which is probably quite slow</li>
<li>The returned array is reduced in size by 2 elements in each dimension (so they do not use a forward/backward scheme at the boundaries)</li>
</ul>
<p>I didn’t find out if CDAT has functions to calculate vorticity, but I tend to think that it uses spherical harmonics and hence allows the computations only on a global grid and only of a vertical component of vorticity.</p>
<h2>Update:</h2>
<h3>Iris</h3>
<p>I discovered that Iris package actually has functions to calculate the finite differences and curl operator in Cartesian or spherical coordinates. It has some limitations and is being developed to work with Iris cubes, but it is the closest solution to what I had in mind writing this post. Here is the link to Iris’ calculus functions:</p>
<p><a href="http://scitools.org.uk/iris/docs/latest/iris/iris/analysis/calculus.html">Iris Calculus</a></p>
<p>I hope that Iris team will continue to develop the calculus submodule and will make it as awesome as the rest of the package.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'dennissergeev'; // required: replace example with your forum shortname

                    var disqus_identifier = 'wind-field-quantities-in-python';
                var disqus_url = 'http://dennissergeev.github.io/wind-field-quantities-in-python.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">



            <li class="list-group-item"><a href="http://dennissergeev.github.io/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                    <li class="list-group-item tag-1">
                        <a href="http://dennissergeev.github.io/tag/dataviz.html">
                            dataviz
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://dennissergeev.github.io/tag/meteorology.html">
                            meteorology
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://dennissergeev.github.io/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://dennissergeev.github.io/tag/atmospheric-science.html">
                            atmospheric science
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://dennissergeev.github.io/tag/polar-lows.html">
                            polar lows
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://dennissergeev.github.io/tag/modelling.html">
                            modelling
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://dennissergeev.github.io/tag/data-formats.html">
                            data formats
                        </a>
                    </li>
                </ul>
            </li>



    <li class="list-group-item"><h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4></li>
    <div id="twitter_timeline">
        <a class="twitter-timeline" data-chrome="noheader" href="https://twitter.com/meteodenny" data-widget-id="572463710745427968">Tweets by meteodenny</a>
    </div>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://earthpy.org/" target="_blank">
                EarthPy
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://ocefpaf.github.io/python4oceanographers/" target="_blank">
                Python4Oceanographers
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://pyaos.johnny-lin.com/" target="_blank">
                PyAOS
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://polarlows.wordpress.com/" target="_blank">
                Polar Lows
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://blogs.reading.ac.uk/weather-and-climate-at-reading" target="_blank">
                Weather and Climate @ Reading
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://frictionvelocity.wordpress.com/" target="_blank">
                FrictionVelocity
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://lukemweather.blogspot.com/" target="_blank">
                Looking Aloft
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://pyhogs.github.io/" target="_blank">
                PyHOGs
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://andrewrushby.com/" target="_blank">
                The II-I blog
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://mycarta.wordpress.com/" target="_blank">
                MyCarta
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.climatesnack.com/" target="_blank">
                ClimateSnack
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://drclimate.wordpress.com/" target="_blank">
                Dr Climate
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://eloquentscience.com/" target="_blank">
                Eloquent Science
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 Denis Sergeev
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://dennissergeev.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://dennissergeev.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://dennissergeev.github.io/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'dennissergeev'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-65884454-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55c2777d723325cf"></script>
</body>
</html>